<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="style/style.css">
    <script src="src/dashboard.js" defer></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const hashtagInput = document.getElementById("boardHashtags");
                const hashtagList = document.getElementById("hashtagList");
                let hashtags = new Set();

                const response = await fetch("/get-user-data");
                const userData = await response.json();

                function updateHashtagDisplay() {
                    hashtagList.innerHTML = "";
                    hashtags.forEach(tag => {
                        const span = document.createElement("span");
                        span.textContent = `#${tag} `;
                        hashtagList.appendChild(span);
                    });
                }

                document.getElementById("addHashtagButton").addEventListener("click", () => {
                    const tag = hashtagInput.value.trim();
                    if (tag && !hashtags.has(tag)) {
                        hashtags.add(tag);
                        updateHashtagDisplay();
                        hashtagInput.value = "";
                    }
                });

                // Allow pressing enter to add a hashtag
                hashtagInput.addEventListener("keydown", (event) => {
                    if (event.key === "Enter") {
                        event.preventDefault();
                        document.getElementById("addHashtagButton").click();
                    }
                });

                document.getElementById("createBoardForm").addEventListener("submit", async (event) => {
                    event.preventDefault();

                    const formData = new FormData(event.target);
                    formData.append("hashtags", Array.from(hashtags).join(" ")); // Send as space-separated

                    try {
                        const response = await fetch("/create", {
                            method: "POST",
                            body: formData
                        });

                        const result = await response.json();

                        if (response.ok) {
                            alert("Board created successfully!");
                            hashtags.clear();
                            updateHashtagDisplay();
                            event.target.reset();
                        } else {
                            alert(`Error: ${result.error}`);
                        }
                    } catch (error) {
                        console.error("Error submitting form:", error);
                        alert("Failed to create board. Please try again.");
                    }
                });
            } catch (error) {
                console.error("Error fetching user data:", error);
            }
        });

    </script>
</head>
<body>

<div class="header">
    <div class="home-buttons">
        <a href="/">Home</a>
        <a href="/discovery">Discovery</a>
        <a href="/events">Events</a>
        <a href="/rnd">Free Space</a>
        <a href="/about-us">About us</a>
    </div>
    <div class="user-buttons">
        <span id="username"></span>
        <span id="dashboard-button"></span>
        <span id="logout-button"></span>
    </div>
</div>
<div class="profile-header-container">
    <img id="userheaderImage" class="header-image" src="uploads/default_header.png" alt="Header Image">
    <img id="userprofileImage" class="profile-image" src="uploads/default_profile.png" alt="Profile Image">
    <input type="file" id="profileImageInput" style="display: none;">
    <input type="file" id="headerImageInput" style="display: none;">
</div>
<div class="user-profile-infos">
    <div class="profile-info"><span class="label">Username:</span> <span id="fetchUsername" class="editable-box" contenteditable="false"></span></div>
    <div class="profile-info"><span class="label">Bio:</span> <span id="fetchBio" class="editable-box" contenteditable="true"></span></div>
    <div class="profile-info"><span class="label">Email:</span> <span id="fetchEmail" class="editable-box" contenteditable="false"></span></div>
    <div class="profile-info"><span class="label">Role:</span> <span id="fetchRole" class="editable-box" contenteditable="false"></span></div>
    <div class="profile-info"><span class="label">Pronouns:</span> <span id="fetchPronouns" class="editable-box" contenteditable="true"></span></div>
    <div class="profile-info"><span class="label">Links:</span> <span id="fetchLinks" class="editable-box" contenteditable="true"></span></div>
    <div class="profile-info"><span class="label">Badges:</span> <span id="fetchBadges" class="editable-box" contenteditable="false"></span></div>
</div>

<div>
    <h2>Boards</h2>
    <div id="userBoardList"></div>
</div>

<div>
    <h2>Create Board</h2>
    <form id="createBoardForm">
        <label for="boardName">Name:</label>
        <input type="text" id="boardName" name="name" required>
        <br>
        <label for="boardType">Board Type:</label>
        <select id="boardType" name="boardType">
            <option value="public">Public</option>
            <option value="private">Private</option>
        </select>
        <br>
        <label for="boardDescription">Description:</label>
        <input type="text" id="boardDescription" name="description" required>
        <br>
        <label for="profileImage">Profile Image:</label>
        <input type="file" id="profileImage" name="profileImage">
        <br>
        <label for="headerImage">Header Image:</label>
        <input type="file" id="headerImage" name="headerImage">
        <br>
        <button type="submit">Create Board</button>
        <label for="boardHashtags">Hashtags:</label>
        <input type="text" id="boardHashtags" name="hashtags">
        <button type="button" id="addHashtagButton">Add Hashtag</button>
        <div id="hashtagList"></div>

    </form>
</div>
<div class="online-users">
    <h3>Online users</h3>
    <ul id="onlineUsers"></ul>
</div>

<button><a href="/home">home</a></button>
<button><a href="/logout">logout</a></button>
<button id="adminButton" style="display: none;"><a href="/admin">Admin Dashboard</a></button>
</body>
</html>
