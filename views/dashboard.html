<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="style/style.css">
    <script src="src/dashboard.js" defer></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const response = await fetch("/get-user-data");
                const userData = await response.json();

                if (userData) {
                    document.getElementById("fetchUsername").innerText = userData.username || "click to edit...";
                    document.getElementById("fetchBio").innerText = userData.bio || "click to edit...";
                    document.getElementById("fetchPronouns").innerText = userData.pronouns || "click to edit...";
                    document.getElementById("fetchLinks").innerText = userData.links || "click to edit...";
                    document.getElementById("fetchBadges").innerText = userData.badges || "click to edit...";
                }
            } catch (error) {
                console.error("Error fetching user data:", error);
            }

            // Enable inline editing and saving on Enter
            document.querySelectorAll(".editable-box").forEach(box => {
                box.addEventListener("keydown", async (event) => {
                    if (event.key === "Enter") {
                        event.preventDefault(); // Prevent new line
                        const fieldId = event.target.id;
                        const newValue = event.target.innerText.trim();

                        console.log("Updating field:", fieldId, "with value:", newValue);

                        if (fieldId && newValue) {
                            await fetch("/update-user", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ field: fieldId, value: newValue })
                            });
                        }
                        event.target.blur(); // Remove focus after saving
                    }
                });
            });
        });
    </script>
</head>
<body>

<div class="header">
    <div class="home-buttons">
        <a href="/">Home</a>
        <a href="/discovery">Discovery</a>
        <a href="/events">Events</a>
        <a href="/rnd">Free Space</a>
        <a href="/about-us">About us</a>
    </div>
    <div class="user-buttons">
        <span id="username"></span>
        <span id="dashboard-button"></span>
        <span id="logout-button"></span>
    </div>
</div>
<div class="profile-header-container">
    <img id="userheaderImage" class="header-image" src="uploads/default_header.png" alt="Header Image">
    <img id="userprofileImage" class="profile-image" src="uploads/default_profile.png" alt="Profile Image">
    <input type="file" id="profileImageInput" style="display: none;">
    <input type="file" id="headerImageInput" style="display: none;">
</div>
<div class="user-profile-infos">
    <div class="profile-info"><span class="label">Username:</span> <span id="fetchUsername" class="editable-box" contenteditable="false"></span></div>
    <div class="profile-info"><span class="label">Bio:</span> <span id="fetchBio" class="editable-box" contenteditable="true"></span></div>
    <div class="profile-info"><span class="label">Email:</span> <span id="fetchEmail" class="editable-box" contenteditable="false"></span></div>
    <div class="profile-info"><span class="label">Role:</span> <span id="fetchRole" class="editable-box" contenteditable="false"></span></div>
    <div class="profile-info"><span class="label">Pronouns:</span> <span id="fetchPronouns" class="editable-box" contenteditable="true"></span></div>
    <div class="profile-info"><span class="label">Links:</span> <span id="fetchLinks" class="editable-box" contenteditable="true"></span></div>
    <div class="profile-info"><span class="label">Badges:</span> <span id="fetchBadges" class="editable-box" contenteditable="false"></span></div>
</div>

<div>
    <h2>Boards</h2>
    <div id="userBoardList"></div>
</div>

<div>
    <h2>Create Board</h2>
    <form id="createBoardForm">
        <label for="boardName">Name:</label>
        <input type="text" id="boardName" name="name" required>
        <br>
        <label for="boardType">Board Type:</label>
        <select id="boardType" name="boardType">
            <option value="public">Public</option>
            <option value="private">Private</option>
        </select>
        <br>
        <label for="boardDescription">Description:</label>
        <input type="text" id="boardDescription" name="description" required>
        <br>
        <label for="profileImage">Profile Image:</label>
        <input type="file" id="profileImage" name="profileImage">
        <br>
        <label for="headerImage">Header Image:</label>
        <input type="file" id="headerImage" name="headerImage">
        <br>
        <button type="submit">Create Board</button>
    </form>
</div>
<div class="online-users">
    <h3>Online users</h3>
    <ul id="onlineUsers"></ul>
</div>

<button><a href="/home">home</a></button>
<button><a href="/logout">logout</a></button>
<button id="adminButton" style="display: none;"><a href="/admin">Admin Dashboard</a></button>
</body>
</html>
